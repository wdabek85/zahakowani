!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.SpriteSpin={})}(this,function(e){"use strict";var r=function(e){this.data=e};function t(e){var t,n=r.prototype;for(t in e)if(e.hasOwnProperty(t)){if(n[t])throw new Error("API method is already defined: "+t);n[t]=e[t]}return n}var i,o,n,d=window.jQuery||window.$;function s(e){var t=e.touches,n=e;return{x:(n=void 0!==(t=void 0===e.touches&&void 0!==e.originalEvent?e.originalEvent.touches:t)&&0<t.length?t[0]:n).clientX||0,y:n.clientY||0}}function g(e,t,n){if(!(o||(i=i||document.createElement("canvas"))&&i.getContext&&(o=i.getContext("2d"))))return!1;if(t*n<=1048576)return!1;i.width=i.height=1,o.fillStyle="#FF00FF",o.fillRect(0,0,1,1),o.drawImage(e,1-t,0);try{var a=o.getImageData(0,0,1,1).data;return 255===a[0]&&0===a[1]&&255===a[2]}catch(e){return!1}}function m(e){var t=Math.floor(e.width||e.frameWidth||e.target.innerWidth()),e=Math.floor(e.height||e.frameHeight||e.target.innerHeight());return{aspect:t/e,height:e,width:t}}function f(e){var t=m(e);if("function"!=typeof window.getComputedStyle)return t;e=window.getComputedStyle(e.target[0]);return e.width&&(t.width=Math.floor(Number(e.width.replace("px",""))),t.height=Math.floor(t.width/t.aspect)),t}function h(e){var t=Math.floor(e.frameWidth||e.width||e.target.innerWidth()),e=Math.floor(e.frameHeight||e.height||e.target.innerHeight());return{aspect:t/e,height:e,width:t}}function p(e,t,n){var a="fit"===e,r="fill"===e,i={width:"100%",height:"100%",top:0,left:0,bottom:0,right:0,position:"absolute",overflow:"hidden"};if(!e||"stretch"===e)return i;var o=t.aspect>=n.aspect,s=t.width,e=t.height;return(a&&o||r&&!o)&&(s=n.width,e=n.width/t.aspect),(r&&o||a&&!o)&&(e=n.height,s=n.height*t.aspect),s=Math.floor(s),e=Math.floor(e),i.width=s,i.height=e,i.top=Math.floor((n.height-e)/2),i.left=Math.floor((n.width-s)/2),i.right=i.left,i.bottom=i.top,i}function v(e){return e.naturalWidth?{height:e.naturalHeight,width:e.naturalWidth}:((n=n||new Image).src=e.src,{height:n.height,width:n.width})}function a(e,t){return 1===e.length?[l(e[0],t)]:(t.framesX&&t.framesY?function(e,t){for(var n=[],a=0;a<e.length;a++){var r=l(e[a],{frames:void 0,framesX:t.framesX,framesY:t.framesY,detectSubsampling:t.detectSubsampling});r.id=a,n.push(r)}return n}:function(e,t){for(var n=[],a=0;a<e.length;a++){var r=l(e[a],{frames:1,framesX:1,detectSubsampling:t.detectSubsampling});r.id=a,n.push(r)}return n})(e,t)}function l(e,t){var n,a,r,i={id:0,sprites:[]};a=t,r=i,e=v(n=e),r.isSubsampled=a.detectSubsampling&&g(n,e.width,e.height),r.width=e.width,r.height=e.height,r.sampledWidth=e.width/(r.isSubsampled?2:1),r.sampledHeight=e.height/(r.isSubsampled?2:1);for(var o=t.frames,s=Number(t.framesX)||o,t=Math.ceil(o/s),l=Math.floor(i.width/s),u=Math.floor(i.height/t),c=i.isSubsampled?2:1,d=0;d<o;d++){var m=d%s*l,f=Math.floor(d/s)*u;i.sprites.push({id:d,x:m,y:f,width:l,height:u,sampledX:m/c,sampledY:f/c,sampledWidth:l/c,sampledHeight:u/c})}return i}function u(e,t,n,a){for(var r=a*t+n,i=0,o=null,s=null;;){if(!(s=e[i]))break;if(!(r>=s.sprites.length)){o=s.sprites[r];break}r-=s.sprites.length,i++}return{sprite:o,sheet:s}}function w(){}function c(e){for(var t=e.source,n="string"==typeof t?[t]:t,a=[],r=e.preloadCount||n.length,t=e.initiated||w,i=e.progress||w,o=e.complete||w,s=0,l=!1,u=!1,c=function(){s+=1,i({index:function(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return n}(this,a),loaded:s,total:n.length,percent:Math.round(s/n.length*100)}),(u=u||this===a[0])&&!l&&r<=s&&(l=!0,o(a))},d=0,m=n;d<m.length;d++){var f=m[d],g=new Image;a.push(g),g.onload=g.onabort=g.onerror=c,g.src=f}t(a)}function b(e,t,n){for(var a=String(e);a.length<t;)a=String(n)+a;return a}function x(e,t){var n=t.digits||2,a=t.lanePlacer||"{lane}",r=t.framePlacer||"{frame}",i=0,o=0;t.frame&&(i=t.frame[0],o=t.frame[1]);var s=0,l=0;t.lane&&(s=t.lane[0],l=t.lane[1]);for(var u=[],c=s;c<=l;c+=1)for(var d=i;d<=o;d+=1)u.push(e.replace(a,b(c,n,"0")).replace(r,b(d,n,"0")));return u}var y="spritespin",k=["mousedown","mousemove","mouseup","mouseenter","mouseover","mouseleave","mousewheel","wheel","click","dblclick","touchstart","touchmove","touchend","touchcancel","selectstart","gesturestart","gesturechange","gestureend"],X=["onInit","onProgress","onLoad","onFrameChanged","onFrame","onDraw","onComplete","onDestroy"],M=["dragstart"],S={source:void 0,width:void 0,height:void 0,frames:void 0,framesX:void 0,lanes:1,sizeMode:void 0,renderer:"canvas",lane:0,frame:0,frameTime:40,animate:!0,retainAnimate:!1,reverse:!1,loop:!0,stopFrame:0,wrap:!0,wrapLane:!1,sense:1,senseLane:void 0,orientation:"horizontal",detectSubsampling:!0,preloadCount:void 0,responsive:void 0,plugins:["360","drag"]};function F(){}function Y(e){return console&&console[e]?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return console.log.apply(console,e)}:F}var z=Y("log"),T=Y("warn"),C=Y("error");function R(e){return Array.isArray(e)?e:[e]}function P(e,t,n){return n<e?n:e<t?t:e}function E(e,t,n,a){for(;n<e;)e-=a;for(;e<t;)e+=a;return e}function A(e){return e.preventDefault(),!1}function D(t,e,n){n&&t.bind(e+"."+y,function(e){n.apply(t,[e,t.spritespin("data")])})}function I(e){e.unbind("."+y)}function W(e){return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)}z=Object.freeze({$:d,getCursorPosition:s,detectSubsampling:g,getOuterSize:m,getComputedSize:f,getInnerSize:h,getInnerLayout:p,measure:a,findSpecs:u,naturalSize:v,preload:c,sourceArray:x,noop:F,log:z,warn:T,error:C,toArray:R,clamp:P,wrap:E,prevent:A,bind:D,unbind:I,isFunction:function(e){return"function"==typeof e},pixelRatio:W});function H(e){e.target.attr("unselectable","on").css({width:"",height:"","-ms-user-select":"none","-moz-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","user-select":"none"});var t=(e.responsive?f:m)(e),n=p(e.sizeMode,h(e),t);e.target.css({width:t.width,height:t.height,position:"relative",overflow:"hidden"}),e.stage.css(n).hide(),e.canvas&&(e.canvas.css(n).hide(),e.canvasRatio=e.canvasRatio||W(e.context),"number"==typeof n.width&&"number"==typeof n.height?(e.canvas[0].width=n.width*e.canvasRatio||t.width,e.canvas[0].height=n.height*e.canvasRatio||t.height):(e.canvas[0].width=t.width*e.canvasRatio,e.canvas[0].height=t.height*e.canvasRatio),e.context.scale(e.canvasRatio,e.canvasRatio))}function L(e,t){return e.state=e.state||{},e.state[t]=e.state[t]||{},e.state[t]}function O(e,t){e=L(e,"plugin");return e[t]=e[t]||{},e[t]}function q(e,t){return!!L(e,"flags")[t]}function B(e,t,n){L(e,"flags")[t]=!!n}function N(e){return L(e,"playback")}function j(e){var t;N(e).handler&&(U(e),(t=e).frame+=t.reverse?-1:1,t.frame=E(t.frame,0,t.frames-1,t.frames),t.loop||t.frame!==t.stopFrame||Z(t),_(e))}function U(e){var t=N(e);t.lastFrame=e.frame,t.lastLane=e.lane}function _(e){var t=N(e);t.lastFrame===e.frame&&t.lastLane===e.lane||e.target.trigger("onFrameChanged."+y,e),e.target.trigger("onFrame."+y,e),e.target.trigger("onDraw."+y,e)}function Q(e,t,n){var a;U(e),null!=t&&((a=e).frame=Number(t),a.frame=a.wrap?E(a.frame,0,a.frames-1,a.frames):P(a.frame,0,a.frames-1)),null!=n&&(a=n,(n=e).lane=n.wrapLane?E(a,0,n.lanes-1,n.lanes):P(a,0,n.lanes-1)),_(e)}function Z(e){e.animate=!1;e=N(e);null!=e.handler&&(window.clearInterval(e.handler),e.handler=null)}function G(e){var t=N(e);!t.handler||e.animate&&t.frameTime===e.frameTime||Z(e),e.animate&&!t.handler&&(t.frameTime=e.frameTime,t.handler=window.setInterval(function(){return j(e)},t.frameTime))}function J(e){e.animate=!0,G(e)}var K={};function V(e,t){if(!K[e])return K[e]=t=t||{};C('Plugin name "'+e+'" is already taken')}function ee(e){return K[e]}function te(e){!function(e){e.mods&&(T('"mods" option is deprecated, use "plugins" instead'),e.plugins=e.mods,delete e.mods);e.behavior&&(T('"behavior" option is deprecated, use "plugins" instead'),e.plugins.push(e.behavior),delete e.behavior);e.module&&(T('"module" option is deprecated, use "plugins" instead'),e.plugins.push(e.module),delete e.module)}(e);for(var t=0;t<e.plugins.length;t+=1){var n,a=e.plugins[t];"string"==typeof a&&((n=ee(a))?e.plugins[t]=n:C("No plugin found with name "+a))}}var ne=d,ae=0,re={};function ie(e){for(var t in re)re.hasOwnProperty(t)&&e(re[t])}var oe=function(){function e(){ie(function(e){e.responsive&&le(e)})}oe=function(){};for(var t=function(t){ne(window.document).bind(t+"."+y,function(e){var r,i;r="document"+t,i=e,ie(function(e){for(var t=0,n=e.plugins;t<n.length;t++){var a=n[t];"function"==typeof a[r]&&a[r].apply(e.target,[i,e])}})})},n=0,a=k;n<a.length;n++)t(a[n]);var r=null;ne(window).on("resize",function(){window.clearTimeout(r),r=window.setTimeout(e,100)})};function se(e){var t=e.target;I(t);for(var n=0,a=M;n<a.length;n++)D(t,d=a[n],A);for(var r=0,i=e.plugins;r<i.length;r++){for(var o=i[r],s=0,l=k;s<l.length;s++)D(t,d=l[s],o[d]);for(var u=0,c=X;u<c.length;u++)D(t,d=c[u],o[d])}D(t,"onLoad",function(e,t){G(t)});for(var d,m=0,f=X;m<f.length;m++)D(t,d=f[m],e[d])}function le(t){te(t),se(t),H(t),t.source=R(t.source),t.loading=!0,t.target.addClass("loading").trigger("onInit."+y,t),c({source:t.source,preloadCount:t.preloadCount,progress:function(e){t.progress=e,t.target.trigger("onProgress."+y,t)},complete:function(e){t.images=e,t.loading=!1,t.frames=t.frames||e.length,function(e){e.images||(e.metrics=[]),e.metrics=a(e.images,e);var t=u(e.metrics,e.frames,0,0);t.sprite&&(e.frameWidth=t.sprite.width,e.frameHeight=t.sprite.height)}(t),H(t),t.stage.show(),t.target.removeClass("loading").trigger("onLoad."+y,t).trigger("onFrame."+y,t).trigger("onDraw."+y,t).trigger("onComplete."+y,t)}})}function ue(e){var t=this,n=e.target,a=ne.extend(!0,{},S,e);return a.source=a.source||[],a.plugins=a.plugins||[],n.find("img").each(function(){Array.isArray(a.source)||(a.source=[]),a.source.push(ne(t).attr("src"))}),n.empty().addClass("spritespin-instance").append("<div class='spritespin-stage'></div>"),"canvas"===a.renderer&&((e=document.createElement("canvas")).getContext&&e.getContext("2d")?(a.canvas=ne(e).addClass("spritespin-canvas"),a.context=e.getContext("2d"),n.append(a.canvas),n.addClass("with-canvas")):a.renderer="image"),a.target=n,a.stage=n.find(".spritespin-stage"),n.data(y,a),ae+=1,(n=a).id=String(ae),re[n.id]=n,a}function ce(e){oe();var t=e.target.data(y);return t?ne.extend(t,e):t=ue(e),le(t),t}function de(e){delete re[e.id],Z(e),e.target.trigger("onDestroy",e).html(null).attr("style",null).attr("unselectable",null).removeClass(["spritespin-instance","with-canvas"]),I(e.target),e.target.removeData(y)}function me(e){return L(e,"input")}function fe(e,t){var n=s(e),e=me(t);e.oldX=e.currentX,e.oldY=e.currentY,e.currentX=n.x,e.currentY=n.y,void 0!==e.oldX&&void 0!==e.oldY||(e.oldX=e.currentX,e.oldY=e.currentY),void 0!==e.startX&&void 0!==e.startY||(e.startX=e.currentX,e.startY=e.currentY,e.clickframe=t.frame,e.clicklane=t.lane),e.dX=e.currentX-e.startX,e.dY=e.currentY-e.startY,e.ddX=e.currentX-e.oldX,e.ddY=e.currentY-e.oldY,e.ndX=e.dX/t.target.innerWidth(),e.ndY=e.dY/t.target.innerHeight(),e.nddX=e.ddX/t.target.innerWidth(),e.nddY=e.ddY/t.target.innerHeight()}function ge(e){e=me(e);e.startX=e.startY=void 0,e.currentX=e.currentY=void 0,e.oldX=e.oldY=void 0,e.dX=e.dY=0,e.ddX=e.ddY=0,e.ndX=e.ndY=0,e.nddX=e.nddY=0}function he(e,t){for(var n=0,a=t;n<a.length;n++){var r=a[n];if(e[r]||r in e)return r}return t[0]}d.fn[y]=function(e,t){var n=d(this);if("data"===e)return n.data(y);if("api"===e){var a=n.data(y);return a.api=a.api||new r(a),a.api}if("destroy"===e)return n.each(function(){var e=n.data(y);e&&de(e)});if(2===arguments.length&&"string"==typeof e&&((a={})[e]=t,e=a),"object"==typeof e)return ce(d.extend(!0,{target:n},e)).target;throw new Error("Invalid call to spritespin")},t({isPlaying:function(){return null!=N(this.data).handler},isLooping:function(){return this.data.loop},toggleAnimation:function(){this.isPlaying()?this.stopAnimation():this.startAnimation()},stopAnimation:function(){this.data.animate=!1,Z(this.data)},startAnimation:function(){this.data.animate=!0,G(this.data)},loop:function(e){return this.data.loop=e,G(this.data),this},currentFrame:function(){return this.data.frame},updateFrame:function(e){return Q(this.data,e),this},skipFrames:function(e){var t=this.data;return Q(t,t.frame+(t.reverse?-e:+e)),this},nextFrame:function(){return this.skipFrames(1)},prevFrame:function(){return this.skipFrames(-1)},playTo:function(e,t){var n,a=this.data;if((t=t||{}).force||a.frame!==e)return t.nearest&&(n=e-a.frame,t=e>a.frame?n-a.frames:n+a.frames,t=Math.abs(n)<Math.abs(t)?n:t,a.reverse=t<0),a.animate=!0,a.loop=!1,a.stopFrame=e,G(a),this}});var pe={requestFullscreen:he(document.documentElement,["requestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"]),exitFullscreen:he(document,["exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"]),fullscreenElement:he(document,["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"]),fullscreenEnabled:he(document,["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"]),fullscreenchange:he(document,["onfullscreenchange","onwebkitfullscreenchange","onmozfullscreenchange","onMSFullscreenChange"]).replace(/^on/,""),fullscreenerror:he(document,["onfullscreenerror","onwebkitfullscreenerror","onmozfullscreenerror","onMSFullscreenError"]).replace(/^on/,"")},ve=pe.fullscreenchange+"."+y+"-fullscreen";function we(){d(document).unbind(ve)}var be,xe,ye,ke,Xe,Me,Se,Fe,Ye,ze,Te,Ce,Re="orientationchange."+y+"-fullscreen";function Pe(){d(window).unbind(Re)}function Ee(){return document[pe.fullscreenElement]}function Ae(t,e){e=e||{};function n(){t.width=window.screen.width,t.height=window.screen.height,t.source=e.source||o,t.sizeMode=e.sizeMode||"fit",t.responsive=!1,le(t)}var a,r=t.width,i=t.height,o=t.source,s=t.sizeMode,l=t.responsive;a=function(){var e;Ee()?(n(),e=n,Pe(),d(window).bind(Re,e)):(we(),Pe(),t.width=r,t.height=i,t.source=o,t.sizeMode=s,t.responsive=l,le(t))},we(),d(document).bind(ve,a),(t.target[0]||document.documentElement)[pe.requestFullscreen]()}function De(e,t){var n,a,r;!t.loading&&t.stage.is(":visible")&&(fe(e,t),n=me(t),e=(r=t.target).offset(),e="horizontal"===t.orientation?(a=r.innerWidth()/2,n.currentX-e.left):(a=r.innerHeight()/2,n.currentY-e.top),Q(t,t.frame+(a<e?1:-1)))}function Ie(e){return O(e,be)}function We(e,t){var n,a=Ie(t);t.loading||q(t,"dragging")||!t.stage.is(":visible")||(n=(new Date).getTime(),a.startAt&&200<n-a.startAt&&e.preventDefault(),a.startAt=n,a.wasPlaying=!!N(t).handler,a.frame=t.frame||0,a.lane=t.lane||0,B(t,"dragging",!0),fe(e,t))}function He(e,t){q(t,"dragging")&&(B(t,"dragging",!1),ge(t),t.retainAnimate&&Ie(t).wasPlaying&&J(t))}function Le(e,t){var n,a,r=Ie(t),i=me(t);q(t,"dragging")&&(fe(e,t),n="number"==typeof(a=t).orientation?a.orientation*Math.PI/180:"horizontal"===a.orientation?0:Math.PI/2,e=Math.sin(n),a=Math.cos(n),n=(i.nddX*a-i.nddY*e)*t.sense||0,a=(i.nddX*e+i.nddY*a)*(t.senseLane||t.sense)||0,r.frame+=t.frames*n,r.lane+=t.lanes*a,t.frame,t.lane,Q(t,Math.floor(r.frame),Math.floor(r.lane)),Z(t))}function Oe(e){return O(e,xe)}function qe(e,t){var n,a;q(t,"loading")||q(t,"dragging")||!t.stage.is(":visible")||((a=Oe(n=t)).frameTime=n.frameTime,a.animate=n.animate,a.reverse=n.reverse,fe(e,t),B(t,"dragging",!0),t.animate=!0,G(t))}function Be(e,t){var n,a;B(t,"dragging",!1),ge(t),Z(t),a=Oe(n=t),n.frameTime=a.frameTime,n.animate=a.animate,n.reverse=a.reverse,G(t)}function Ne(e,t){var n,a,r,i;q(t,"dragging")&&(fe(e,t),n=me(t),r=(a=t.target).offset(),i="horizontal"===t.orientation?(i=a.innerWidth()/2,(n.currentX-r.left-i)/i):(i=t.height/2,(n.currentY-r.top-i)/i),t.reverse=i<0,t.frameTime=80*(1-(i=i<0?-i:i))+20,("horizontal"===t.orientation&&n.dX<n.dY||"vertical"===t.orientation&&n.dX<n.dY)&&e.preventDefault())}function je(e){return O(e,ye)}function $e(e,t,n){return e[t]||n}function Ue(e,t){t.loading||q(t,"dragging")||(fe(e,t),B(t,"dragging",!0))}function _e(e,t){q(t,"dragging")&&(fe(e,t),Q(t,t.frame,t.lane))}function Qe(e,t){var n,a,r,i,o,s;q(t,"dragging")&&(B(t,"dragging",!1),i=je(t),s=me(t),n=t.frame,a=t.lane,r=i.snap,i=i.fling,s="horizontal"===t.orientation?(o=s.ndX,s.ddX):(o=s.ndY,s.ddY),r<=o||i<=s?n=t.frame-1:(o<=-r||s<=-i)&&(n=t.frame+1),ge(t),Q(t,n,a),Z(t))}function Ze(e){return O(e,ke)}function Ge(e){return O(e,Xe)}function Je(e,t,n){return e[t]||n}function Ke(e){var t=Ge(e);t.timeout=window.setTimeout(function(){!function(e){var t=Ge(e);if(Ve(e),t.context){var n=0;!function(e,t){t.canvas.show();t.canvas[0].width,e.canvasRatio,t.canvas[0].height,e.canvasRatio}(e,t),t.context.clearRect(0,0,e.width,e.height);for(var a=0,r=t.steps;a<r.length;a++){var i=r[a];i.live=Math.max(i.live-i.step,0),i.alpha=Math.max(i.live-.25,0),function(e,t,n){var a,r,i;n.alpha<=0||(r=u(e.metrics,e.frames,n.frame,n.lane),i=r.sheet,a=r.sprite,i&&a&&(e.source[i.id],!1!==(r=e.images[i.id]).complete&&(t.canvas.show(),i=t.canvas[0].width/e.canvasRatio,e=t.canvas[0].height/e.canvasRatio,t.context.globalAlpha=n.alpha,t.context.drawImage(r,a.sampledX,a.sampledY,a.sampledWidth,a.sampledHeight,0,0,i,e))))}(e,t,i),n+=i.alpha+i.d}t.cssBlur&&function(e,t){t="blur("+Math.min(Math.max(t/2-4,0),2.5)+"px)";e.css({"-webkit-filter":t,filter:t})}(t.canvas,n),function(e){for(var t=Me.length=0;t<e.length;t+=1)e[t].alpha<=0&&Me.push(t);for(var n=0,a=Me;n<a.length;n++){var r=a[n];e.splice(r,1)}}(t.steps),t.steps.length&&Ke(e)}}(e)},t.frameTime)}function Ve(e){e=Ge(e);window.clearTimeout(e.timeout),e.timeout=null}function et(e){return O(e,Ye)}function tt(e,t,n){return e[t]||n}function nt(e,t){q(t,"dragging")&&(rt(t),function(e){var t=et(e);t.samples.push({time:(new Date).getTime(),frame:e.frame,lane:e.lane});for(;t.samples.length>t.maxSamples;)t.samples.shift()}(t))}function at(e,t){for(var n,a=et(t),r=a.samples,i=0,o=0,s=0,l=0,u=r;l<u.length;l++){var c=u[l];if(n){var d=c.time-n.time;if(d>a.abortTime)return i=o=s=0,rt(t);o+=c.frame-n.frame,i+=c.lane-n.lane,s+=d,n=c}else n=c}r.length=0,s&&(a.lane=t.lane,a.lanes=0,a.laneStep=i/s*a.updateTime,a.frame=t.frame,a.frames=0,a.frameStep=o/s*a.updateTime,it(t))}function rt(e){e=et(e);null!=e.handler&&(window.clearTimeout(e.handler),e.handler=null)}function it(e){var t=et(e);t.handler=window.setTimeout(function(){!function(e){var t=et(e);t.lanes+=t.laneStep,t.frames+=t.frameStep,t.laneStep*=t.damping,t.frameStep*=t.damping;var n=Math.floor(t.frame+t.frames),a=Math.floor(t.lane+t.lanes);Q(e,n,a),(!q(e,"dragging")&&(.005<Math.abs(t.frameStep)||.005<Math.abs(t.laneStep))?it:rt)(e)}(e)},t.updateTime)}function ot(e){return O(e,ze)}function st(e,t,n){return e[t]||n}function lt(e){return O(e,Te)}function ut(e){return O(e,Ce)}function ct(e,t,n){return e[t]||n}function dt(e,t){var n,a,r,i,o=ut(t);o.stage.is(":visible")&&(e.preventDefault(),B(t,"dragging",!1),n=(i=s(e)).x/t.width,a=i.y/t.height,null==o.oldX&&(o.oldX=n,o.oldY=a),null==o.currentX&&(o.currentX=n,o.currentY=a),r=n-o.oldX,i=a-o.oldY,o.oldX=n,o.oldY=a,e.type.match(/touch/)&&(r=-r,i=-i),o.currentX=P(o.currentX+r,0,1),o.currentY=P(o.currentY+i,0,1),Q(t,t.frame,t.lane))}function mt(e,t){e.preventDefault();var n=ut(t),a=(new Date).getTime();!n.clickTime||a-n.clickTime>n.doubleClickTime?n.clickTime=a:(n.clickTime=void 0,gt(t)&&dt(e,t))}function ft(e,t){ut(t).stage.is(":visible")&&dt(e,t)}function gt(e){var t=ut(e);if(!t.stage)throw new Error("zoom module is not initialized or is not available.");if(!t.stage.is(":visible"))return t.stage.fadeIn(),e.stage.fadeOut(),1;t.stage.fadeOut(),e.stage.fadeIn()}t({fullscreenEnabled:function(){return document[pe.fullscreenEnabled]},fullscreenElement:Ee,exitFullscreen:function(){return document[pe.exitFullscreen]()},toggleFullscreen:function(e){!function(e){Ee()?this.apiRequestFullscreen(e):this.exitFullscreen()}((this.data,e))},requestFullscreen:function(e){Ae(this.data,e)}}),V("click",{name:"click",mouseup:De,touchend:De}),V(be="drag",{name:"drag",mousedown:We,mousemove:Le,mouseup:He,documentmousemove:Le,documentmouseup:He,touchstart:We,touchmove:Le,touchend:He,touchcancel:He}),V("move",{name:"move",mousemove:function(e,t){We(e,t),Le(e,t)},mouseleave:He,touchstart:We,touchmove:Le,touchend:He,touchcancel:He}),V(xe="hold",{name:xe,mousedown:qe,mousemove:Ne,mouseup:Be,mouseleave:Be,touchstart:qe,touchmove:Ne,touchend:Be,touchcancel:Be,onFrame:function(e,t){t.animate=!0,G(t)}}),V(ye="swipe",{name:ye,onLoad:function(e,t){var n=je(t);n.fling=$e(t,"swipeFling",10),n.snap=$e(t,"swipeSnap",.5)},mousedown:Ue,mousemove:_e,mouseup:Qe,mouseleave:Qe,touchstart:Ue,touchmove:_e,touchend:Qe,touchcancel:Qe}),V("wheel",{name:"wheel",wheel:function(e,t){var n;!t.loading&&t.stage.is(":visible")&&(e.preventDefault(),e=0===(n=e.originalEvent).deltaX?0:0<n.deltaX?1:-1,n=0===n.deltaY?0:0<n.deltaY?1:-1,Q(t,t.frame+n,t.lane+e))}}),V(ke="progress",{name:ke,onInit:function(e,t){var n=Ze(t);n.stage||(n.stage=d("\n<div class='spritespin-progress'>\n  <div class='spritespin-progress-label'></div>\n  <div class='spritespin-progress-bar'></div>\n</div>\n"),n.stage.appendTo(t.target)),n.stage.find(".spritespin-progress-label").text("0%").css({"text-align":"center"}),n.stage.find(".spritespin-progress-bar").css({width:"0%"}),n.stage.hide().fadeIn()},onProgress:function(e,t){var n=Ze(t);n.stage.find(".spritespin-progress-label").text(t.progress.percent+"%").css({"text-align":"center"}),n.stage.find(".spritespin-progress-bar").css({width:t.progress.percent+"%"})},onLoad:function(e,t){d(Ze(t).stage).fadeOut()},onDestroy:function(e,t){d(Ze(t).stage).remove()}}),V("360",{name:"360",onLoad:function(e,t){t.stage.find(".spritespin-frames").detach(),"image"===t.renderer&&$(t.images).addClass("spritespin-frames").appendTo(t.stage)},onDraw:function(e,t){var n=u(t.metrics,t.frames,t.frame,t.lane),a=n.sheet,r=n.sprite;if(a&&r){var i=t.source[a.id],o=t.images[a.id];if("canvas"===t.renderer){t.canvas.show();var s=t.canvas[0].width/t.canvasRatio,l=t.canvas[0].height/t.canvasRatio;return t.context.clearRect(0,0,s,l),void t.context.drawImage(o,r.sampledX,r.sampledY,r.sampledWidth,r.sampledHeight,0,0,s,l)}n=t.stage.innerWidth()/r.sampledWidth,s=t.stage.innerHeight()/r.sampledHeight,l=Math.floor(-r.sampledY*s),r=Math.floor(-r.sampledX*n),n=Math.floor(a.sampledWidth*n),s=Math.floor(a.sampledHeight*s);"background"!==t.renderer?($(t.images).hide(),$(o).show().css({position:"absolute",top:l,left:r,"max-width":"initial",width:n,height:s})):t.stage.css({"background-image":"url('"+i+"')","background-position":r+"px "+l+"px","background-repeat":"no-repeat","-webkit-background-size":n+"px "+s+"px","-moz-background-size":n+"px "+s+"px","-o-background-size":n+"px "+s+"px","background-size":n+"px "+s+"px"})}}}),Me=[],V(Xe="blur",{name:Xe,onLoad:function(e,t){var n=Ge(t);n.canvas=n.canvas||d("<canvas class='blur-layer'></canvas>"),n.context=n.context||n.canvas[0].getContext("2d"),n.steps=n.steps||[],n.fadeTime=Math.max(Je(t,"blurFadeTime",200),1),n.frameTime=Math.max(Je(t,"blurFrameTime",t.frameTime),16),n.trackTime=null,n.cssBlur=!!Je(t,"blurCss",!1);var a=h(t),r=(t.responsive?f:m)(t),r=p(t.sizeMode,a,r);n.canvas[0].width=t.width*t.canvasRatio,n.canvas[0].height=t.height*t.canvasRatio,n.canvas.css(r).show(),n.context.scale(t.canvasRatio,t.canvasRatio),t.target.append(n.canvas)},onFrameChanged:function(e,t){var n,a,r,i=Ge(t);a=Ge(n=t),r=N(n),r=(r=Math.abs(n.frame-r.lastFrame))>=n.frames/2?n.frames-r:r,a.steps.unshift({frame:n.frame,lane:n.lane,live:1,step:a.frameTime/a.fadeTime,d:r,alpha:0}),null==i.timeout&&Ke(t)}}),Se=Math.max,Fe=Math.min,V(Ye="ease",{name:Ye,onLoad:function(e,t){var n=et(t);n.maxSamples=Se(tt(t,"easeMaxSamples",5),0),n.damping=Se(Fe(tt(t,"easeDamping",.9),.999),0),n.abortTime=Se(tt(t,"easeAbortTime",250),16),n.updateTime=Se(tt(t,"easeUpdateTime",t.frameTime),16),n.samples=[],n.steps=[]},mousemove:nt,mouseup:at,mouseleave:at,touchmove:nt,touchend:at,touchcancel:at}),V(ze="gallery",{name:ze,onLoad:function(e,t){var n=ot(t);n.images=[],n.offsets=[],n.frame=t.frame,n.speed=st(t,"gallerySpeed",500),n.opacity=st(t,"galleryOpacity",.25),n.stage=st(t,"galleryStage",d("<div></div>")),n.stage.empty().addClass("gallery-stage").prependTo(t.stage);for(var a=0,r=0,i=t.images;r<i.length;r++){var o=i[r],s=v(o),l=t.height/s.height,s=d(o);n.stage.append(s),n.images.push(s),n.offsets.push(-a+(t.width-o.width*l)/2),a+=t.width,s.css({"max-width":"initial",opacity:n.opacity,width:t.width,height:t.height})}var u=h(t),c=(t.responsive?f:m)(t),c=p(t.sizeMode,u,c);n.stage.css(c).css({width:a,left:n.offsets[n.frame]}),n.images[n.frame].animate({opacity:1},{duration:n.speed})},onDraw:function(e,t){var n=ot(t),a=me(t),r=q(t,"dragging");n.frame===t.frame||r?!r&&n.dX===a.dX||(n.dX=a.dX,n.ddX=a.ddX,n.stage.stop(!0,!0).css({left:n.offsets[n.frame]+n.dX})):(n.stage.stop(!0,!1).animate({left:n.offsets[t.frame]},{duration:n.speed}),n.images[n.frame].animate({opacity:n.opacity},{duration:n.speed}),n.frame=t.frame,n.images[n.frame].animate({opacity:1},{duration:n.speed}),n.stage.animate({left:n.offsets[n.frame]}))}}),V(Te="panorama",{name:Te,onLoad:function(e,t){var n,a=lt(t),r=t.metrics[0];r&&("horizontal"===t.orientation?(a.scale=t.target.innerHeight()/r.sampledHeight,t.frames=r.sampledWidth):(a.scale=t.target.innerWidth()/r.sampledWidth,t.frames=r.sampledHeight),n=Math.floor(r.sampledWidth*a.scale),a=Math.floor(r.sampledHeight*a.scale),t.stage.css({"background-image":"url("+t.source[r.id]+")","background-repeat":"repeat-both","-webkit-background-size":n+"px "+a+"px","-moz-background-size":n+"px "+a+"px","-o-background-size":n+"px "+a+"px","background-size":n+"px "+a+"px"}))},onDraw:function(e,t){var n=lt(t),a=(i="horizontal"===t.orientation?1:0)?0:1,r=t.frame%t.frames,i=Math.round(i*r*n.scale),n=Math.round(a*r*n.scale);t.stage.css({"background-position":i+"px "+n+"px"})}}),V(Ce="zoom",{name:Ce,mousedown:mt,touchstart:mt,mousemove:ft,touchmove:ft,onInit:function(e,t){var n=ut(t);n.source=ct(t,"zoomSource",t.source),n.doubleClickTime=ct(t,"zoomDoubleClickTime",500),n.stage=n.stage||d("<div class='zoom-stage'></div>"),n.stage.css({width:"100%",height:"100%",top:0,left:0,bottom:0,right:0,position:"absolute"}).appendTo(t.target).hide()},onDestroy:function(e,t){(t=ut(t)).stage&&(t.stage.remove(),delete t.stage)},onDraw:function(e,t){var n=ut(t),a=t.lane*t.frames+t.frame,r=n.source[a],i=u(t.metrics,t.frames,t.frame,t.lane),o=n.currentX,s=n.currentY;null==o&&(o=n.currentX=.5,s=n.currentY=.5),r?(o=Math.floor(100*o),s=Math.floor(100*s),n.stage.css({"background-repeat":"no-repeat","background-image":"url('"+r+"')","background-position":o+"% "+s+"%"})):i.sheet&&i.sprite&&(a=i.sprite,r=i.sheet,i=t.source[r.id],o=-Math.floor(a.sampledX+o*(a.sampledWidth-t.width)),a=-Math.floor(a.sampledY+s*(a.sampledHeight-t.height)),t=r.sampledWidth,r=r.sampledHeight,n.stage.css({"background-image":"url('"+i+"')","background-position":o+"px "+a+"px","background-repeat":"no-repeat","-webkit-background-size":t+"px "+r+"px","-moz-background-size":t+"px "+r+"px","-o-background-size":t+"px "+r+"px","background-size":t+"px "+r+"px"}))}}),t({toggleZoom:function(){gt(this.data)}}),e.Utils=z,e.sourceArray=x,e.Api=r,e.extendApi=t,e.instances=re,e.applyEvents=se,e.boot=le,e.create=ue,e.createOrUpdate=ce,e.destroy=de,e.namespace=y,e.eventNames=k,e.callbackNames=X,e.eventsToPrevent=M,e.defaults=S,e.getInputState=me,e.updateInput=fe,e.resetInput=ge,e.applyLayout=H,e.getPlaybackState=N,e.updateFrame=Q,e.stopAnimation=Z,e.applyAnimation=G,e.startAnimation=J,e.registerPlugin=V,e.registerModule=function(e,t){T('"registerModule" is deprecated, use "registerPlugin" instead'),V(e,t)},e.getPlugin=ee,e.applyPlugins=te,e.getState=L,e.getPluginState=O,e.is=q,e.flag=B,Object.defineProperty(e,"__esModule",{value:!0})});